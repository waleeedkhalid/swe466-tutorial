<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Management System</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition: background-color 0.3s ease, border-color 0.3s ease,
          color 0.3s ease, box-shadow 0.3s ease;
      }

      /* Dark Theme (Default) */
      :root,
      [data-theme="dark"] {
        --bg: #0f1419;
        --bg-card: #1a1f26;
        --bg-hover: #242b33;
        --border: #2d3640;
        --text: #e7e9ea;
        --text-muted: #71767b;
        --primary: #1d9bf0;
        --primary-hover: #1a8cd8;
        --danger: #f4212e;
        --danger-hover: #dc1e28;
        --success: #00ba7c;
        --radius: 12px;
      }

      /* Light Theme */
      [data-theme="light"] {
        --bg: #f5f8fa;
        --bg-card: #ffffff;
        --bg-hover: #e8ecef;
        --border: #cfd9de;
        --text: #0f1419;
        --text-muted: #536471;
        --primary: #1d9bf0;
        --primary-hover: #1a8cd8;
        --danger: #f4212e;
        --danger-hover: #dc1e28;
        --success: #00ba7c;
        --radius: 12px;
      }

      body {
        font-family: "DM Sans", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        line-height: 1.5;
      }

      header {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-hover) 100%
        );
        border-bottom: 1px solid var(--border);
        padding: 1.5rem 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(12px);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--primary) 0%, #00d4aa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .theme-toggle {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 50px;
        padding: 0.5rem 1rem;
      }

      .theme-toggle span {
        font-size: 0.875rem;
        color: var(--text-muted);
        font-weight: 500;
      }

      .theme-switch {
        position: relative;
        width: 50px;
        height: 26px;
        background: var(--border);
        border-radius: 50px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .theme-switch::before {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background: var(--text);
        border-radius: 50%;
        transition: transform 0.3s ease, background-color 0.3s ease;
      }

      [data-theme="light"] .theme-switch {
        background: var(--primary);
      }

      [data-theme="light"] .theme-switch::before {
        transform: translateX(24px);
      }

      .sync-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: var(--text-muted);
        padding: 0.25rem 0.75rem;
        background: var(--bg);
        border-radius: 20px;
        border: 1px solid var(--border);
      }

      .sync-status .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
      }

      .sync-status.syncing .dot {
        background: var(--primary);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      main {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        background: var(--bg-card);
        padding: 0.5rem;
        border-radius: var(--radius);
        border: 1px solid var(--border);
      }

      .tab-btn {
        flex: 1;
        padding: 0.875rem 1.5rem;
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .tab-btn:hover {
        background: var(--bg-hover);
        color: var(--text);
      }

      .tab-btn.active {
        background: var(--primary);
        color: white;
      }

      .tab-btn svg {
        width: 18px;
        height: 18px;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .card h2 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--text);
      }

      .card h3 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text);
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        align-items: end;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-muted);
      }

      input,
      select {
        padding: 0.75rem 1rem;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        font-size: 0.9375rem;
        font-family: inherit;
        transition: border-color 0.2s ease, box-shadow 0.2s ease,
          background-color 0.3s ease, color 0.3s ease;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(29, 155, 240, 0.15);
      }

      input::placeholder {
        color: var(--text-muted);
      }

      button {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        font-family: inherit;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background: var(--danger-hover);
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-muted);
        padding: 0.5rem;
      }

      .btn-ghost:hover {
        background: var(--bg-hover);
        color: var(--text);
      }

      .btn-full {
        width: 100%;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      th {
        font-weight: 600;
        color: var(--text);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      td {
        color: var(--text-muted);
      }

      tr:hover td {
        background: var(--bg-hover);
      }

      .actions {
        display: flex;
        gap: 0.5rem;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1.5rem;
        color: var(--text-muted);
      }

      .empty-state svg {
        width: 48px;
        height: 48px;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .checkbox-group {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem;
        max-height: 200px;
        overflow-y: auto;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s ease, color 0.2s ease;
      }

      .checkbox-item:hover {
        background: var(--bg-hover);
      }

      .checkbox-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary);
        cursor: pointer;
      }

      .checkbox-item label {
        cursor: pointer;
        color: var(--text);
      }

      .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        padding: 1rem 1.5rem;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .toast.success {
        border-left: 4px solid var(--success);
      }

      .toast.error {
        border-left: 4px solid var(--danger);
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .report-section {
        margin-bottom: 2rem;
      }

      .total-row {
        font-weight: 700;
        background: var(--bg-hover) !important;
      }

      .total-row td {
        color: var(--primary);
      }

      /* Modal Dialog */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1.5rem;
        width: 90%;
        max-width: 500px;
        transform: scale(0.9);
        transition: transform 0.3s ease, background-color 0.3s ease,
          border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .modal-overlay.active .modal {
        transform: scale(1);
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
      }

      .modal-header h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .modal-header h3 svg {
        color: var(--primary);
      }

      .modal-close {
        background: transparent;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 6px;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: var(--bg-hover);
        color: var(--text);
      }

      .modal-body {
        margin-bottom: 1.5rem;
      }

      .modal-body p {
        color: var(--text-muted);
        margin-bottom: 1rem;
      }

      .modal-detail {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem;
      }

      .modal-detail-row {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border);
      }

      .modal-detail-row:last-child {
        border-bottom: none;
      }

      .modal-detail-label {
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      .modal-detail-value {
        color: var(--text);
        font-weight: 500;
      }

      .modal-footer {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }

      .btn-secondary {
        background: var(--bg-hover);
        color: var(--text);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      /* Table Loading State */
      .table-container {
        position: relative;
        min-height: 100px;
      }

      .table-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-card);
        opacity: 0;
        visibility: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        transition: opacity 0.2s ease, visibility 0.2s ease;
      }

      body.app-loading .table-loading-overlay {
        visibility: visible;
        opacity: 0.8;
      }

      .spinner-small {
        width: 24px;
        height: 24px;
        border: 2px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .tabs {
          flex-wrap: wrap;
        }

        .tab-btn {
          flex: 1 1 calc(50% - 0.25rem);
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        table {
          font-size: 0.875rem;
        }

        th,
        td {
          padding: 0.75rem 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-left">
        <h1>Project Management System</h1>
        <div class="sync-status" id="syncStatus">
          <span class="dot"></span>
          <span>Synced</span>
        </div>
      </div>
      <div class="theme-toggle">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          style="color: var(--text-muted)"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
          />
        </svg>
        <div
          class="theme-switch"
          id="themeSwitch"
          onclick="toggleTheme()"
        ></div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          style="color: var(--text-muted)"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          />
        </svg>
      </div>
    </header>

    <main>
      <div class="tabs">
        <button class="tab-btn active" data-tab="tasks">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
            />
          </svg>
          Tasks
        </button>
        <button class="tab-btn" data-tab="resources">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
            />
          </svg>
          Resources
        </button>
        <button class="tab-btn" data-tab="allocation">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
            />
          </svg>
          Allocation
        </button>
        <button class="tab-btn" data-tab="reports">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
          Reports
        </button>
      </div>

      <!-- Tasks Tab -->
      <div id="tasks" class="tab-content active">
        <div class="card">
          <h2>Task Management</h2>
          <form id="taskForm" class="form-grid">
            <input type="hidden" id="taskId" />
            <div class="form-group">
              <label for="taskName">Task Name</label>
              <input
                type="text"
                id="taskName"
                required
                placeholder="Enter task name"
              />
            </div>
            <div class="form-group">
              <label for="duration">Duration</label>
              <input
                type="text"
                id="duration"
                required
                placeholder="e.g., 5 days"
              />
            </div>
            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate" required />
            </div>
            <div class="form-group">
              <label for="finishDate">Finish Date (Optional)</label>
              <input type="date" id="finishDate" />
            </div>
            <div class="form-group">
              <button
                type="submit"
                class="btn-primary btn-full"
                id="taskSubmitBtn"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  />
                </svg>
                Add Task
              </button>
            </div>
          </form>
        </div>

        <div class="card">
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tasksTableBody"></tbody>
            </table>
            <div id="tasksEmpty" class="empty-state" style="display: none">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                />
              </svg>
              <p>No tasks yet. Add your first task above.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Resources Tab -->
      <div id="resources" class="tab-content">
        <div class="card">
          <h2>Resource Management</h2>
          <form id="resourceForm" class="form-grid">
            <input type="hidden" id="resourceId" />
            <div class="form-group">
              <label for="resourceName">Resource Name</label>
              <input
                type="text"
                id="resourceName"
                required
                placeholder="Enter resource name"
              />
            </div>
            <div class="form-group">
              <label for="resourceType">Type</label>
              <select
                id="resourceType"
                required
                onchange="toggleResourceFields()"
              >
                <option value="Work">Work</option>
                <option value="Cost">Cost</option>
              </select>
            </div>
            <!-- Work Resource Fields -->
            <div class="form-group work-fields">
              <label for="maxUnits">Max (Units)</label>
              <input type="text" id="maxUnits" placeholder="e.g., 100%" />
            </div>
            <div class="form-group work-fields">
              <label for="stRate">St. Rate</label>
              <input type="text" id="stRate" placeholder="e.g., 15$/hr" />
            </div>
            <!-- Cost Resource Fields -->
            <div class="form-group cost-fields" style="display: none">
              <label for="costPerUse">Cost/Use</label>
              <input type="text" id="costPerUse" placeholder="e.g., 1000" />
            </div>
            <div class="form-group">
              <button
                type="submit"
                class="btn-primary btn-full"
                id="resourceSubmitBtn"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  />
                </svg>
                Add Resource
              </button>
            </div>
          </form>
        </div>

        <div class="card">
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Resource Name</th>
                  <th>Type</th>
                  <th>Max (Units)</th>
                  <th>St. Rate</th>
                  <th>Cost/Use</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="resourcesTableBody"></tbody>
            </table>
            <div id="resourcesEmpty" class="empty-state" style="display: none">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
              <p>No resources yet. Add your first resource above.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Allocation Tab -->
      <div id="allocation" class="tab-content">
        <div class="card">
          <h2>Allocate Resources to Tasks</h2>
          <form id="allocationForm">
            <div class="form-group" style="margin-bottom: 1rem">
              <label for="selectTask">Select Task</label>
              <select id="selectTask" required>
                <option value="">Choose a task</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom: 1rem">
              <label>Select Resources</label>
              <div id="resourceCheckboxes" class="checkbox-group">
                <p style="color: var(--text-muted)">
                  No resources available. Add resources first.
                </p>
              </div>
            </div>
            <button type="submit" class="btn-primary btn-full">
              Allocate Resources
            </button>
          </form>
        </div>

        <div class="card">
          <h3>Current Allocations</h3>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                  <th>Resources</th>
                </tr>
              </thead>
              <tbody id="allocationsTableBody"></tbody>
            </table>
            <div
              id="allocationsEmpty"
              class="empty-state"
              style="display: none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                />
              </svg>
              <p>No allocations yet. Allocate resources to tasks above.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports Tab -->
      <div id="reports" class="tab-content">
        <div class="card report-section">
          <h2>Report 4: All Tasks</h2>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                </tr>
              </thead>
              <tbody id="report4Body"></tbody>
            </table>
          </div>
        </div>

        <div class="card report-section">
          <h2>Report 5: All Resources</h2>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Resource Name</th>
                  <th>Type</th>
                  <th>Max (Units)</th>
                  <th>St. Rate</th>
                  <th>Ovt.</th>
                  <th>Cost/Use</th>
                </tr>
              </thead>
              <tbody id="report5Body"></tbody>
            </table>
          </div>
        </div>

        <div class="card report-section">
          <h2>Report 6: All Tasks + Resources</h2>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                  <th>Resources</th>
                </tr>
              </thead>
              <tbody id="report6Body"></tbody>
            </table>
          </div>
        </div>

        <div class="card report-section">
          <h2>Report 7: Total Cost for Each Task</h2>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                  <th>Resources</th>
                  <th>Total Cost</th>
                </tr>
              </thead>
              <tbody id="report7Body"></tbody>
            </table>
          </div>
        </div>

        <div class="card report-section">
          <h2>Report 8: Total Cost for Whole Project</h2>
          <div class="table-container" style="overflow-x: auto">
            <div class="table-loading-overlay">
              <div class="spinner-small"></div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Task ID</th>
                  <th>Task Name</th>
                  <th>Duration</th>
                  <th>Start Date</th>
                  <th>Finish Date</th>
                  <th>Resources</th>
                  <th>Total Cost</th>
                </tr>
              </thead>
              <tbody id="report8Body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <!-- Update Task Modal -->
    <div class="modal-overlay" id="updateTaskModal">
      <div class="modal">
        <div class="modal-header">
          <h3>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            Update Task
          </h3>
          <button class="modal-close" onclick="closeUpdateModal()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to update this task with the following
            details?
          </p>
          <div class="modal-detail">
            <div class="modal-detail-row">
              <span class="modal-detail-label">Task Name</span>
              <span class="modal-detail-value" id="modalTaskName">-</span>
            </div>
            <div class="modal-detail-row">
              <span class="modal-detail-label">Duration</span>
              <span class="modal-detail-value" id="modalDuration">-</span>
            </div>
            <div class="modal-detail-row">
              <span class="modal-detail-label">Start Date</span>
              <span class="modal-detail-value" id="modalStartDate">-</span>
            </div>
            <div class="modal-detail-row">
              <span class="modal-detail-label">Finish Date</span>
              <span class="modal-detail-value" id="modalFinishDate">-</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeUpdateModal()">
            Cancel
          </button>
          <button
            class="btn-primary"
            id="confirmUpdateBtn"
            onclick="confirmTaskUpdate()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
            Confirm Update
          </button>
        </div>
      </div>
    </div>

    <script>
      // ==========================================
      // FAKE BACKEND API LAYER
      // ==========================================
      const FakeBackend = {
        // Simulated network delay (ms)
        delay: 300,

        // Simulated database using localStorage
        db: {
          tasks: "pms_tasks",
          resources: "pms_resources",
          settings: "pms_settings",
        },

        // Simulate async API call with delay
        async simulate(callback) {
          setSyncStatus("syncing");
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              try {
                const result = callback();
                setSyncStatus("synced");
                resolve(result);
              } catch (error) {
                setSyncStatus("error");
                reject(error);
              }
            }, this.delay);
          });
        },

        // Tasks API
        tasks: {
          async getAll() {
            return FakeBackend.simulate(() => {
              const data = localStorage.getItem(FakeBackend.db.tasks);
              return data ? JSON.parse(data) : [];
            });
          },

          async create(task) {
            return FakeBackend.simulate(() => {
              const tasks = JSON.parse(
                localStorage.getItem(FakeBackend.db.tasks) || "[]"
              );
              task.id = Date.now().toString();
              task.resourceNames = [];
              task.createdAt = new Date().toISOString();
              task.updatedAt = new Date().toISOString();
              tasks.push(task);
              localStorage.setItem(FakeBackend.db.tasks, JSON.stringify(tasks));
              return task;
            });
          },

          async update(id, updates) {
            return FakeBackend.simulate(() => {
              const tasks = JSON.parse(
                localStorage.getItem(FakeBackend.db.tasks) || "[]"
              );
              const index = tasks.findIndex((t) => t.id === id);
              if (index === -1) throw new Error("Task not found");
              tasks[index] = {
                ...tasks[index],
                ...updates,
                updatedAt: new Date().toISOString(),
              };
              localStorage.setItem(FakeBackend.db.tasks, JSON.stringify(tasks));
              return tasks[index];
            });
          },

          async delete(id) {
            return FakeBackend.simulate(() => {
              const tasks = JSON.parse(
                localStorage.getItem(FakeBackend.db.tasks) || "[]"
              );
              const filtered = tasks.filter((t) => t.id !== id);
              localStorage.setItem(
                FakeBackend.db.tasks,
                JSON.stringify(filtered)
              );
              return { success: true };
            });
          },

          async allocateResources(taskId, resourceNames) {
            return FakeBackend.simulate(() => {
              const tasks = JSON.parse(
                localStorage.getItem(FakeBackend.db.tasks) || "[]"
              );
              const index = tasks.findIndex((t) => t.id === taskId);
              if (index === -1) throw new Error("Task not found");
              tasks[index].resourceNames = resourceNames;
              tasks[index].updatedAt = new Date().toISOString();
              localStorage.setItem(FakeBackend.db.tasks, JSON.stringify(tasks));
              return tasks[index];
            });
          },
        },

        // Resources API
        resources: {
          async getAll() {
            return FakeBackend.simulate(() => {
              const data = localStorage.getItem(FakeBackend.db.resources);
              return data ? JSON.parse(data) : [];
            });
          },

          async create(resource) {
            return FakeBackend.simulate(() => {
              const resources = JSON.parse(
                localStorage.getItem(FakeBackend.db.resources) || "[]"
              );
              resource.id = Date.now().toString();
              resource.createdAt = new Date().toISOString();
              resource.updatedAt = new Date().toISOString();
              resources.push(resource);
              localStorage.setItem(
                FakeBackend.db.resources,
                JSON.stringify(resources)
              );
              return resource;
            });
          },

          async update(id, updates) {
            return FakeBackend.simulate(() => {
              const resources = JSON.parse(
                localStorage.getItem(FakeBackend.db.resources) || "[]"
              );
              const index = resources.findIndex((r) => r.id === id);
              if (index === -1) throw new Error("Resource not found");
              resources[index] = {
                ...resources[index],
                ...updates,
                updatedAt: new Date().toISOString(),
              };
              localStorage.setItem(
                FakeBackend.db.resources,
                JSON.stringify(resources)
              );
              return resources[index];
            });
          },

          async delete(id) {
            return FakeBackend.simulate(() => {
              const resources = JSON.parse(
                localStorage.getItem(FakeBackend.db.resources) || "[]"
              );
              const filtered = resources.filter((r) => r.id !== id);
              localStorage.setItem(
                FakeBackend.db.resources,
                JSON.stringify(filtered)
              );
              return { success: true };
            });
          },
        },

        // Settings API
        settings: {
          async get(key) {
            return FakeBackend.simulate(() => {
              const settings = JSON.parse(
                localStorage.getItem(FakeBackend.db.settings) || "{}"
              );
              return settings[key];
            });
          },

          async set(key, value) {
            return FakeBackend.simulate(() => {
              const settings = JSON.parse(
                localStorage.getItem(FakeBackend.db.settings) || "{}"
              );
              settings[key] = value;
              localStorage.setItem(
                FakeBackend.db.settings,
                JSON.stringify(settings)
              );
              return { success: true };
            });
          },
        },
      };

      // ==========================================
      // SYNC STATUS INDICATOR
      // ==========================================
      let activeRequests = 0;

      function setSyncStatus(status) {
        const statusEl = document.getElementById("syncStatus");
        const textEl = statusEl.querySelector("span:last-child");

        if (status === "syncing") {
          activeRequests++;
        } else if (status === "synced" || status === "error") {
          activeRequests--;
        }

        if (activeRequests < 0) activeRequests = 0;

        if (activeRequests > 0) {
          statusEl.classList.add("syncing");
          textEl.textContent = "Syncing...";
          document.body.classList.add("app-loading");
        } else {
          statusEl.classList.remove("syncing");
          if (status === "error") {
            textEl.textContent = "Error";
          } else {
            textEl.textContent = "Synced";
          }
          document.body.classList.remove("app-loading");
        }
      }

      // ==========================================
      // THEME MANAGEMENT
      // ==========================================
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("pms_theme", newTheme);
      }

      function initTheme() {
        const savedTheme = localStorage.getItem("pms_theme") || "dark";
        document.documentElement.setAttribute("data-theme", savedTheme);
      }

      // Initialize theme immediately
      initTheme();

      // ==========================================
      // DATA STORE (In-Memory Cache)
      // ==========================================
      let tasks = [];
      let resources = [];

      // ==========================================
      // HELPER FUNCTIONS
      // ==========================================
      function formatDate(dateStr) {
        if (!dateStr) return "";
        // Handle date string in YYYY-MM-DD format (from input[type=date])
        // Parse as local date to avoid timezone issues
        const parts = dateStr.split("-");
        if (parts.length === 3) {
          const year = parseInt(parts[0], 10);
          const month = parseInt(parts[1], 10);
          const day = parseInt(parts[2], 10);
          return `${String(day).padStart(2, "0")}/${String(month).padStart(
            2,
            "0"
          )}/${year}`;
        }
        // Fallback for other date formats
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return dateStr;
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      function formatDateForDisplay(dateStr) {
        // More readable format for modal display
        if (!dateStr) return "-";
        const parts = dateStr.split("-");
        if (parts.length === 3) {
          const months = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];
          const year = parseInt(parts[0], 10);
          const month = parseInt(parts[1], 10) - 1;
          const day = parseInt(parts[2], 10);
          return `${months[month]} ${day}, ${year}`;
        }
        return dateStr;
      }

      function showToast(message, type = "success") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          ${
            type === "success"
              ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>'
              : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>'
          }
        </svg>
        ${message}
      `;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      function calculateTaskCost(task) {
        if (!task.resourceNames || task.resourceNames.length === 0) return 0;

        const durationMatch = task.duration.match(/(\d+)/);
        const days = durationMatch ? parseInt(durationMatch[1]) : 0;
        const hoursPerDay = 8;

        let totalCost = 0;

        task.resourceNames.forEach((resourceName) => {
          const resource = resources.find(
            (r) => r.resourceName === resourceName
          );
          if (!resource) return;

          if (resource.type === "Work" && resource.stRate) {
            const rateMatch = resource.stRate.match(/(\d+)/);
            const hourlyRate = rateMatch ? parseFloat(rateMatch[1]) : 0;
            totalCost += days * hoursPerDay * hourlyRate;
          } else if (resource.type === "Cost" && resource.costPerUse) {
            totalCost += parseFloat(resource.costPerUse) || 0;
          }
        });

        return totalCost;
      }

      // ==========================================
      // TAB NAVIGATION
      // ==========================================
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));
          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");

          if (btn.dataset.tab === "allocation") updateAllocationForm();
          if (btn.dataset.tab === "reports") updateReports();
        });
      });

      // ==========================================
      // TASKS MANAGEMENT
      // ==========================================
      const taskForm = document.getElementById("taskForm");
      const taskSubmitBtn = document.getElementById("taskSubmitBtn");
      let pendingTaskUpdate = null; // Store pending update data

      // Auto-calculate finish date based on start date and duration
      function calculateFinishDate() {
        const startDateInput = document.getElementById("startDate");
        const durationInput = document.getElementById("duration");
        const finishDateInput = document.getElementById("finishDate");

        const startDate = startDateInput.value;
        const duration = durationInput.value;

        if (startDate && duration) {
          const durationMatch = duration.match(/(\d+)/);
          if (durationMatch) {
            const days = parseInt(durationMatch[1]);
            const start = new Date(startDate);
            start.setDate(start.getDate() + days);

            // Format as YYYY-MM-DD for the date input
            const year = start.getFullYear();
            const month = String(start.getMonth() + 1).padStart(2, "0");
            const day = String(start.getDate()).padStart(2, "0");
            finishDateInput.value = `${year}-${month}-${day}`;
          }
        }
      }

      // Add event listeners to auto-calculate finish date
      document
        .getElementById("startDate")
        .addEventListener("change", calculateFinishDate);
      document
        .getElementById("duration")
        .addEventListener("input", calculateFinishDate);

      taskForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const editId = document.getElementById("taskId").value;
        const taskData = {
          taskName: document.getElementById("taskName").value,
          duration: document.getElementById("duration").value,
          startDate: document.getElementById("startDate").value,
          finishDate: document.getElementById("finishDate").value,
        };

        if (editId) {
          // Show confirmation modal for updates
          pendingTaskUpdate = { editId, taskData };
          showUpdateModal(taskData);
        } else {
          // Create new task directly
          try {
            await FakeBackend.tasks.create(taskData);
            showToast("Task added successfully");
            tasks = await FakeBackend.tasks.getAll();
            renderTasks();
            resetTaskForm();
          } catch (error) {
            showToast("Error saving task: " + error.message, "error");
          }
        }
      });

      function showUpdateModal(taskData) {
        document.getElementById("modalTaskName").textContent =
          taskData.taskName;
        document.getElementById("modalDuration").textContent =
          taskData.duration;
        document.getElementById("modalStartDate").textContent =
          formatDateForDisplay(taskData.startDate);
        document.getElementById("modalFinishDate").textContent =
          formatDateForDisplay(taskData.finishDate);
        document.getElementById("updateTaskModal").classList.add("active");
      }

      function closeUpdateModal() {
        document.getElementById("updateTaskModal").classList.remove("active");
        pendingTaskUpdate = null;
      }

      async function confirmTaskUpdate() {
        if (!pendingTaskUpdate) return;

        const { editId, taskData } = pendingTaskUpdate;

        try {
          const existingTask = tasks.find((t) => t.id === editId);
          await FakeBackend.tasks.update(editId, {
            ...taskData,
            resourceNames: existingTask?.resourceNames || [],
          });
          showToast("Task updated successfully");
          tasks = await FakeBackend.tasks.getAll();
          renderTasks();
          resetTaskForm();
          closeUpdateModal();
        } catch (error) {
          showToast("Error updating task: " + error.message, "error");
          closeUpdateModal();
        }
      }

      function resetTaskForm() {
        taskForm.reset();
        document.getElementById("taskId").value = "";
        taskSubmitBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Add Task
        `;
      }

      // Close modal when clicking outside
      document
        .getElementById("updateTaskModal")
        .addEventListener("click", (e) => {
          if (e.target.id === "updateTaskModal") {
            closeUpdateModal();
          }
        });

      // Close modal with Escape key
      document.addEventListener("keydown", (e) => {
        if (
          e.key === "Escape" &&
          document
            .getElementById("updateTaskModal")
            .classList.contains("active")
        ) {
          closeUpdateModal();
        }
      });

      function renderTasks() {
        const tbody = document.getElementById("tasksTableBody");
        const empty = document.getElementById("tasksEmpty");

        if (tasks.length === 0) {
          tbody.innerHTML = "";
          empty.style.display = "block";
          return;
        }

        empty.style.display = "none";
        tbody.innerHTML = tasks
          .map(
            (task) => `
        <tr>
          <td>${task.id}</td>
          <td style="color: var(--text)">${task.taskName}</td>
          <td>${task.duration}</td>
          <td>${formatDate(task.startDate)}</td>
          <td>${formatDate(task.finishDate)}</td>
          <td>
            <div class="actions">
              <button class="btn-ghost" onclick="editTask('${task.id}')">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </button>
              <button class="btn-ghost" onclick="deleteTask('${task.id}')">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `
          )
          .join("");
      }

      window.editTask = function (id) {
        const task = tasks.find((t) => t.id === id);
        if (!task) return;

        document.getElementById("taskId").value = task.id;
        document.getElementById("taskName").value = task.taskName;
        document.getElementById("duration").value = task.duration;
        document.getElementById("startDate").value = task.startDate;
        document.getElementById("finishDate").value = task.finishDate;
        taskSubmitBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Update Task
      `;

        // Scroll to form
        document
          .getElementById("taskForm")
          .scrollIntoView({ behavior: "smooth" });
      };

      window.deleteTask = async function (id) {
        if (!confirm("Are you sure you want to delete this task?")) return;

        try {
          await FakeBackend.tasks.delete(id);
          tasks = await FakeBackend.tasks.getAll();
          renderTasks();
          showToast("Task deleted");
        } catch (error) {
          showToast("Error deleting task: " + error.message, "error");
        }
      };

      // ==========================================
      // RESOURCES MANAGEMENT
      // ==========================================
      const resourceForm = document.getElementById("resourceForm");
      const resourceSubmitBtn = document.getElementById("resourceSubmitBtn");

      // Toggle resource fields based on type selection
      function toggleResourceFields() {
        const resourceType = document.getElementById("resourceType").value;
        const workFields = document.querySelectorAll(".work-fields");
        const costFields = document.querySelectorAll(".cost-fields");

        if (resourceType === "Work") {
          workFields.forEach((field) => (field.style.display = "flex"));
          costFields.forEach((field) => (field.style.display = "none"));
          // Clear cost fields when switching to Work
          document.getElementById("costPerUse").value = "";
        } else {
          workFields.forEach((field) => (field.style.display = "none"));
          costFields.forEach((field) => (field.style.display = "flex"));
          // Clear work fields when switching to Cost
          document.getElementById("maxUnits").value = "";
          document.getElementById("stRate").value = "";
        }
      }

      resourceForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const editId = document.getElementById("resourceId").value;
        const resourceData = {
          resourceName: document.getElementById("resourceName").value,
          type: document.getElementById("resourceType").value,
          max: document.getElementById("maxUnits").value,
          stRate: document.getElementById("stRate").value,
          costPerUse: document.getElementById("costPerUse").value,
        };

        try {
          if (editId) {
            await FakeBackend.resources.update(editId, resourceData);
            showToast("Resource updated successfully");
          } else {
            await FakeBackend.resources.create(resourceData);
            showToast("Resource added successfully");
          }

          resources = await FakeBackend.resources.getAll();
          renderResources();

          resourceForm.reset();
          document.getElementById("resourceId").value = "";
          resourceSubmitBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Add Resource
        `;
          // Reset to show Work fields by default
          toggleResourceFields();
        } catch (error) {
          showToast("Error saving resource: " + error.message, "error");
        }
      });

      function renderResources() {
        const tbody = document.getElementById("resourcesTableBody");
        const empty = document.getElementById("resourcesEmpty");

        if (resources.length === 0) {
          tbody.innerHTML = "";
          empty.style.display = "block";
          return;
        }

        empty.style.display = "none";
        tbody.innerHTML = resources
          .map(
            (resource) => `
        <tr>
          <td style="color: var(--text)">${resource.resourceName}</td>
          <td>${resource.type}</td>
          <td>${resource.max || ""}</td>
          <td>${resource.stRate || ""}</td>
          <td>${resource.costPerUse || ""}</td>
          <td>
            <div class="actions">
              <button class="btn-ghost" onclick="editResource('${
                resource.id
              }')">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </button>
              <button class="btn-ghost" onclick="deleteResource('${
                resource.id
              }')">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `
          )
          .join("");
      }

      window.editResource = function (id) {
        const resource = resources.find((r) => r.id === id);
        if (!resource) return;

        document.getElementById("resourceId").value = resource.id;
        document.getElementById("resourceName").value = resource.resourceName;
        document.getElementById("resourceType").value = resource.type;
        document.getElementById("maxUnits").value = resource.max || "";
        document.getElementById("stRate").value = resource.stRate || "";
        document.getElementById("costPerUse").value = resource.costPerUse || "";

        // Toggle fields based on resource type
        toggleResourceFields();

        resourceSubmitBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Update Resource
      `;

        document
          .getElementById("resourceForm")
          .scrollIntoView({ behavior: "smooth" });
      };

      window.deleteResource = async function (id) {
        if (!confirm("Are you sure you want to delete this resource?")) return;

        try {
          await FakeBackend.resources.delete(id);
          resources = await FakeBackend.resources.getAll();
          renderResources();
          showToast("Resource deleted");
        } catch (error) {
          showToast("Error deleting resource: " + error.message, "error");
        }
      };

      // ==========================================
      // ALLOCATION MANAGEMENT
      // ==========================================
      const allocationForm = document.getElementById("allocationForm");

      function updateAllocationForm() {
        const selectTask = document.getElementById("selectTask");
        selectTask.innerHTML =
          '<option value="">Choose a task</option>' +
          tasks
            .map((t) => `<option value="${t.id}">${t.taskName}</option>`)
            .join("");

        const checkboxes = document.getElementById("resourceCheckboxes");
        if (resources.length === 0) {
          checkboxes.innerHTML =
            '<p style="color: var(--text-muted);">No resources available. Add resources first.</p>';
        } else {
          checkboxes.innerHTML = resources
            .map(
              (r) => `
          <div class="checkbox-item">
            <input type="checkbox" id="res_${r.id}" value="${r.id}">
            <label for="res_${r.id}">${r.resourceName} (${r.type})</label>
          </div>
        `
            )
            .join("");
        }

        renderAllocations();
      }

      allocationForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const taskId = document.getElementById("selectTask").value;
        if (!taskId) {
          showToast("Please select a task", "error");
          return;
        }

        const selectedResources = Array.from(
          document.querySelectorAll("#resourceCheckboxes input:checked")
        )
          .map((cb) => resources.find((r) => r.id === cb.value)?.resourceName)
          .filter(Boolean);

        if (selectedResources.length === 0) {
          showToast("Please select at least one resource", "error");
          return;
        }

        try {
          await FakeBackend.tasks.allocateResources(taskId, selectedResources);
          tasks = await FakeBackend.tasks.getAll();
          renderAllocations();
          showToast("Resources allocated successfully");

          document.getElementById("selectTask").value = "";
          document
            .querySelectorAll("#resourceCheckboxes input")
            .forEach((cb) => (cb.checked = false));
        } catch (error) {
          showToast("Error allocating resources: " + error.message, "error");
        }
      });

      function renderAllocations() {
        const tbody = document.getElementById("allocationsTableBody");
        const empty = document.getElementById("allocationsEmpty");

        const allocatedTasks = tasks.filter(
          (t) => t.resourceNames && t.resourceNames.length > 0
        );

        if (allocatedTasks.length === 0) {
          tbody.innerHTML = "";
          empty.style.display = "block";
          return;
        }

        empty.style.display = "none";
        tbody.innerHTML = allocatedTasks
          .map(
            (task) => `
        <tr>
          <td>${task.id}</td>
          <td style="color: var(--text)">${task.taskName}</td>
          <td>${task.duration}</td>
          <td>${formatDate(task.startDate)}</td>
          <td>${formatDate(task.finishDate)}</td>
          <td style="color: var(--primary)">${task.resourceNames.join(
            ", "
          )}</td>
        </tr>
      `
          )
          .join("");
      }

      // ==========================================
      // REPORTS
      // ==========================================
      function updateReports() {
        // Report 4: All Tasks
        document.getElementById("report4Body").innerHTML =
          tasks.length > 0
            ? tasks
                .map(
                  (task) => `
        <tr>
          <td>${task.id}</td>
          <td style="color: var(--text)">${task.taskName}</td>
          <td>${task.duration}</td>
          <td>${formatDate(task.startDate)}</td>
          <td>${formatDate(task.finishDate)}</td>
        </tr>
      `
                )
                .join("")
            : '<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">No tasks available</td></tr>';

        // Report 5: All Resources
        document.getElementById("report5Body").innerHTML =
          resources.length > 0
            ? resources
                .map(
                  (resource) => `
        <tr>
          <td style="color: var(--text)">${resource.resourceName}</td>
          <td>${resource.type}</td>
          <td>${resource.max || "-"}</td>
          <td>${resource.stRate || "-"}</td>
          <td>-</td>
          <td>${resource.costPerUse || "-"}</td>
        </tr>
      `
                )
                .join("")
            : '<tr><td colspan="6" style="text-align: center; color: var(--text-muted);">No resources available</td></tr>';

        // Report 6: All Tasks + Resources
        document.getElementById("report6Body").innerHTML =
          tasks.length > 0
            ? tasks
                .map(
                  (task) => `
        <tr>
          <td>${task.id}</td>
          <td style="color: var(--text)">${task.taskName}</td>
          <td>${task.duration}</td>
          <td>${formatDate(task.startDate)}</td>
          <td>${formatDate(task.finishDate)}</td>
          <td style="color: var(--primary)">${
            task.resourceNames?.join(", ") || "-"
          }</td>
        </tr>
      `
                )
                .join("")
            : '<tr><td colspan="6" style="text-align: center; color: var(--text-muted);">No data available</td></tr>';

        // Report 7: Total Cost for Each Task
        document.getElementById("report7Body").innerHTML =
          tasks.length > 0
            ? tasks
                .map((task) => {
                  const cost = calculateTaskCost(task);
                  return `
          <tr>
            <td>${task.id}</td>
            <td style="color: var(--text)">${task.taskName}</td>
            <td>${task.duration}</td>
            <td>${formatDate(task.startDate)}</td>
            <td>${formatDate(task.finishDate)}</td>
            <td style="color: var(--primary)">${
              task.resourceNames?.join(", ") || "-"
            }</td>
            <td style="color: var(--success); font-weight: 600;">${
              cost > 0 ? "$" + cost.toLocaleString() : "-"
            }</td>
          </tr>
        `;
                })
                .join("")
            : '<tr><td colspan="7" style="text-align: center; color: var(--text-muted);">No data available</td></tr>';

        // Report 8: Total Cost for Whole Project
        const totalProjectCost = tasks.reduce(
          (sum, task) => sum + calculateTaskCost(task),
          0
        );
        let report8Content = "";

        if (tasks.length > 0) {
          report8Content = tasks
            .map((task) => {
              const cost = calculateTaskCost(task);
              return `
            <tr>
              <td>${task.id}</td>
              <td style="color: var(--text)">${task.taskName}</td>
              <td>${task.duration}</td>
              <td>${formatDate(task.startDate)}</td>
              <td>${formatDate(task.finishDate)}</td>
              <td style="color: var(--primary)">${
                task.resourceNames?.join(", ") || "-"
              }</td>
              <td style="color: var(--success); font-weight: 600;">${
                cost > 0 ? "$" + cost.toLocaleString() : "-"
              }</td>
            </tr>
          `;
            })
            .join("");

          report8Content += `
          <tr class="total-row">
            <td colspan="6" style="text-align: right; font-weight: 700;">Total Project Cost:</td>
            <td style="color: var(--success); font-weight: 700; font-size: 1.125rem;">$${totalProjectCost.toLocaleString()}</td>
          </tr>
        `;
        } else {
          report8Content =
            '<tr><td colspan="7" style="text-align: center; color: var(--text-muted);">No data available</td></tr>';
        }

        document.getElementById("report8Body").innerHTML = report8Content;
      }

      // ==========================================
      // INITIALIZATION
      // ==========================================
      async function initializeApp() {
        try {
          // Load data from fake backend
          [tasks, resources] = await Promise.all([
            FakeBackend.tasks.getAll(),
            FakeBackend.resources.getAll(),
          ]);

          // Render initial views
          renderTasks();
          renderResources();

          console.log(" Project Management System initialized");
          console.log(
            ` Loaded ${tasks.length} tasks and ${resources.length} resources`
          );
        } catch (error) {
          console.error("Error initializing app:", error);
          showToast("Error loading data", "error");
        }
      }

      // Start the app
      initializeApp();
    </script>
  </body>
</html>
